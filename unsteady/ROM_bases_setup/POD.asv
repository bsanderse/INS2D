function [basis,trunc_Sigma_sqrd] = POD(snapshot_matrix,no_modes)

[U,S,~] = svd(snapshot_matrix,'econ');

cond_fac = 10^-6;
X_bc_rank = sum(abs(Sigma_bc/Sigma_bc(1))>cond_fac);
if Mbc > X_bc_rank
    Mbc = X_bc_rank;
end
         
%% limit number of modes to meaningful ones
cond_fac = 1e-6;
Sigma = diag(S)
no_modes2 = sum(abs(Sigma/Sigma(1)

%%

basis = U(:,1:no_modes);
trunc_Sigma_sqrd = (S(1:no_modes,1:no_modes))^2;